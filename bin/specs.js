!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function o(e){var t=document.createEvent("MouseEvents");return t.initMouseEvent("click",!0,!0,document.defaultView,0,0,0,0,0,!1,!1,!1,!1,null,null),e.dispatchEvent(t)}var i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},c=n(1),r=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype.render=function(){c.elementOpen("div",null,null,"style",{display:"inline",color:this.props.importance>5?"red":"gray"}),c.text(this.props.message),c.elementClose()},t}(c.Component),l=function(e){function t(t){e.call(this,t),this.setState({tired:!1})}return i(t,e),t.prototype.render=function(){c.elementVoid(r,null,null,"importance",this.props.importance,"message",this.state.tired?"tired":"ok")},t}(c.Component),d=[],u=0,p=0,a=0,m=0,f=0,s=0,v=0,h=0,x=0,y=!1,B=void 0,V=void 0,b=function(){function e(){d.push("constructor"),u++,B&&(this.state=B)}return e.prototype.getState=function(){return V||{frodo:3}},e.prototype.componentWillMount=function(){d.push("componentWillMount"),p++},e.prototype.componentDidMount=function(){d.push("componentDidMount"),a++},e.prototype.componentWillReceiveProps=function(e){d.push("componentWillReceiveProps"),m++},e.prototype.shouldComponentUpdate=function(e,t){return d.push("shouldComponentUpdate"),f++,!y},e.prototype.componentWillUpdate=function(e,t){d.push("componentWillUpdate"),s++},e.prototype.componentDidUpdate=function(e,t){d.push("componentDidUpdate"),v++},e.prototype.componentWillUnmount=function(){d.push("componentWillUnmount"),h++},e.prototype.render=function(){d.push("render"),x++,c.elementVoid("div",null,null,"frozen",y?"yes":"no")},e}();describe("a patch",function(){var e,t,n=[],i=function(e){return Object.getOwnPropertyNames(e)};beforeEach(function(o){t=document.body.innerHTML,e=document.createElement("div"),document.body.appendChild(e),setTimeout(function(){var e=[window,document,document.body];n=e.map(function(e){return i(e)}),d=[],u=0,p=0,a=0,m=0,f=0,s=0,v=0,h=0,x=0,y=!1,o()})}),afterEach(function(){document.body.removeChild(e),expect(document.body.innerHTML.trim()).toBe(t.trim());var o=[window,document,document.body],c=o.map(function(e){return i(e)});expect(c).toEqual(n)}),it("does nothing if nothing is rendered",function(){c.patch(e,function(){return null}),expect(e.outerHTML).toBe("<div></div>"),e.setAttribute("data-id","3"),e.innerHTML="somestuff",c.patch(e,function(){return null}),expect(e.outerHTML).toBe('<div data-id="3">somestuff</div>')}),it("can use elementVoid to insert a div",function(){c.patch(e,function(){c.elementVoid("div")}),expect(e.outerHTML).toBe("<div><div></div></div>")}),it("will remove something",function(){c.patch(e,function(){c.elementOpen("span",null,null),c.elementClose()}),expect(e.outerHTML).toBe("<div><span></span></div>"),c.patch(e,function(){return null}),expect(e.outerHTML).toBe("<div></div>")}),it("can replace and add things",function(){c.patch(e,function(){c.elementOpen("div",null,null),c.elementClose()}),c.patch(e,function(){c.elementOpen("div",null,null),c.elementClose(),c.elementOpen("div",null,null),c.elementClose()}),expect(e.outerHTML).toBe("<div><div></div><div></div></div>")}),it("doesn't re-add the same div",function(){for(var t=function(){return c.patch(e,function(){c.elementOpen("div",null,null),c.elementClose()})},n=0;3>n;n++)t(),expect(e.outerHTML).toBe("<div><div></div></div>")}),it("handles attributes",function(){c.patch(e,function(){c.elementOpen("div",null,null,"id","the_id","style",{color:"red"}),c.elementClose()}),expect(e.outerHTML).toBe('<div><div id="the_id" style="color: red;"></div></div>')}),it("mutates attributes",function(){var t={color:"red"};c.patch(e,function(){c.elementOpen("div",null,null,"id","the_id","style",t),c.elementClose()}),expect(e.outerHTML).toBe('<div><div id="the_id" style="color: red;"></div></div>'),t.color="blue",c.patch(e,function(){c.elementOpen("div",null,null,"id","the_id","style",t),c.elementClose()}),t.backgroundColor="red",delete t.color,c.patch(e,function(){c.elementOpen("div",null,null,"id","the_id","style",t),c.elementClose()}),expect(e.outerHTML).toBe('<div><div id="the_id" style="background-color: red;"></div></div>')}),it("adds attributes",function(){c.patch(e,function(){c.elementOpen("div",null,null,"id","the_id"),c.elementClose()}),expect(e.outerHTML).toBe('<div><div id="the_id"></div></div>'),c.patch(e,function(){c.elementOpen("div",null,null,"id","the_id","name","fred"),c.elementClose()}),expect(e.outerHTML).toBe('<div><div id="the_id" name="fred"></div></div>')}),it("removes attributes",function(){c.patch(e,function(){c.elementOpen("div",null,null,"id","the_id","name","fred"),c.elementClose()}),expect(e.outerHTML).toBe('<div><div id="the_id" name="fred"></div></div>'),c.patch(e,function(){c.elementVoid("div",null,null,"id","the_id")}),expect(e.outerHTML).toBe('<div><div id="the_id"></div></div>'),c.patch(e,function(){c.elementVoid("div",null,["id","the_id","frodo","121"],"data-frame","anterior")}),expect(e.outerHTML).toBe('<div><div id="the_id" frodo="121" data-frame="anterior"></div></div>')}),it("deals with a component",function(){c.patch(e,function(){c.elementVoid(b)}),expect(e.outerHTML).toBe('<div><div frozen="no"></div></div>')}),describe("with state set in the constructor",function(){beforeEach(function(){B={frodo:!0}}),afterEach(function(){B=void 0}),it("doesn't call getState",function(){c.patch(e,function(){c.elementVoid(b)});var t=e.__reactiv_view_node.kids[0];expect(t.component.state.frodo).toBe(!0)})}),describe("with state not set in the constructor",function(){beforeEach(function(){V={frodo:!0}}),afterEach(function(){V=void 0}),it("calls getState",function(){c.patch(e,function(){c.elementVoid(b)});var t=e.__reactiv_view_node.kids[0];expect(t.component.state.frodo).toBe(!0)})}),it("adds event handlers",function(){var t=!1,n=0,i=function(e){n++,t&&e.preventDefault()};c.patch(e,function(){c.elementVoid("div",null,["onClick",i])}),expect(e.outerHTML).toBe("<div><div></div></div>");var r=!o(e.children[0]);expect(r).toBe(!1),expect(n).toBe(1),t=!0,r=!o(e.children[0]),expect(r).toBe(!0),expect(n).toBe(2),c.patch(e,function(){c.elementVoid("div",null,["onClick",i])}),t=!1,r=!o(e.children[0]),expect(r).toBe(!1),expect(n).toBe(3)}),it("removes event handlers",function(){var t=!1,n=0,i=function(e){n++,t&&e.preventDefault()};c.patch(e,function(){c.elementVoid("div",null,["onClick",i])}),expect(e.outerHTML).toBe("<div><div></div></div>");var r=!o(e.children[0]);expect(r).toBe(!1),expect(n).toBe(1),t=!0,r=!o(e.children[0]),expect(r).toBe(!0),expect(n).toBe(2),c.patch(e,function(){c.elementVoid("div",null,null)}),r=!o(e.children[0]),expect(r).toBe(!1),expect(n).toBe(2)}),it("changes event handlers",function(){var t=0,n=function(e){t++},i=function(e){t+=100,e.preventDefault()};c.patch(e,function(){c.elementVoid("div",null,["onClick",n])}),expect(e.outerHTML).toBe("<div><div></div></div>");var r=!o(e.children[0]);expect(r).toBe(!1),expect(t).toBe(1),c.patch(e,function(){c.elementVoid("div",null,["onClick",i])}),r=!o(e.children[0]),expect(r).toBe(!0),expect(t).toBe(101)}),it("allows elements to mutate themselves",function(){c.patch(e,function(){return c.elementVoid("div")}),e.children[0].innerHTML="dynamic",c.patch(e,function(){return c.elementVoid("div")}),expect(e.outerHTML).toBe("<div><div>dynamic</div></div>")}),it("constructs components appropriately",function(){c.patch(e,function(){return c.elementVoid(b)}),expect(u).toBe(1),c.patch(e,function(){return c.elementVoid(b)}),expect(u).toBe(1),c.patch(e,function(){return null}),expect(u).toBe(1),c.patch(e,function(){return c.elementVoid(b)}),expect(u).toBe(2)}),it("calls componentWillMount appropriately",function(){c.patch(e,function(){return c.elementVoid(b)}),expect(p).toBe(1),c.patch(e,function(){return c.elementVoid(b)}),expect(p).toBe(1)}),it("calls componentDidMount appropriately",function(){c.patch(e,function(){return c.elementVoid(b)}),expect(a).toBe(1),c.patch(e,function(){return c.elementVoid(b)}),expect(a).toBe(1)}),it("calls componentWillUnmount appropriately",function(){c.patch(e,function(){return c.elementVoid(b)}),expect(h).toBe(0),c.patch(e,function(){return c.elementVoid(b)}),expect(h).toBe(0),c.patch(e,function(){return null}),expect(h).toBe(1)}),it("calls componentWillUpdate appropriately",function(){c.patch(e,function(){return c.elementVoid(b,void 0,void 0,"data-index","1")}),expect(s).toBe(0),c.patch(e,function(){return c.elementVoid(b)}),expect(s).toBe(1),c.patch(e,function(){return null}),expect(s).toBe(1)}),it("calls componentDidUpdate appropriately",function(){c.patch(e,function(){return c.elementVoid(b)}),expect(v).toBe(0),c.patch(e,function(){return c.elementVoid(b)}),expect(v).toBe(1),c.patch(e,function(){return null}),expect(v).toBe(1)}),it("calls shouldComponentUpdate appropriately",function(){c.patch(e,function(){return c.elementVoid(b)}),expect(f).toBe(0),c.patch(e,function(){return c.elementVoid(b)}),expect(f).toBe(1),c.patch(e,function(){return null}),expect(f).toBe(1)}),it("calls mounting lifecycle methods in the correct order",function(){c.patch(e,function(){return c.elementVoid(b)}),expect(d.join(" => ")).toBe("constructor => componentWillMount => render => componentDidMount")}),it("calls re-render lifecycle methods in the correct order",function(){c.patch(e,function(){return c.elementVoid(b)}),d=[],c.patch(e,function(){return c.elementVoid(b)}),expect(d.join(" => ")).toBe("componentWillReceiveProps => shouldComponentUpdate => componentWillUpdate => render => componentDidUpdate")}),it("respects shouldComponentUpdate",function(){c.patch(e,function(){return c.elementVoid(b)}),d=[],y=!0,c.patch(e,function(){return c.elementVoid(b)}),expect(d.join(" => ")).toBe("componentWillReceiveProps => shouldComponentUpdate"),expect(e.outerHTML).toBe('<div><div frozen="no"></div></div>')}),it("calls unmounting lifecycle methods in the correct order",function(){c.patch(e,function(){return c.elementVoid(b)}),d=[],c.patch(e,function(){return null}),expect(d.join(" => ")).toBe("componentWillUnmount")}),it("unmounts components",function(){c.patch(e,function(){c.elementVoid(b,null,null,null)}),expect(e.outerHTML).toBe('<div><div frozen="no"></div></div>'),expect(p).toBe(1),expect(a).toBe(1),c.patch(e,function(){c.elementVoid("div",null,null,null)}),expect(e.outerHTML).toBe("<div><div></div></div>"),expect(p).toBe(1),expect(a).toBe(1),expect(h).toBe(1)}),it("recognises nested components",function(){(new Date).getTime();c.patch(e,function(){c.elementVoid(l,null,null,"importance",7,"name","bond, jimmy-bob melon-field bond")}),expect(e.outerHTML).toBe('<div><div style="display: inline; color: red;">ok</div></div>')}),it("is fast",function(){for(var t=(new Date).getTime(),n=1e4,o=0;n>o;)c.patch(e,function(){return c.elementVoid(l,null,null,"importance",o++%10,"name","bond, jimmy-bob "+(o%2?"melon-field":"princess")+" bond")});var i=(new Date).getTime()-t;console.log("benchmark: "+n+" took "+i+" ms = "+Math.ceil(i/n*1e4)/10+" us per"),expect(i).toBeLessThan(2500)}),it("deals with keys",function(){c.patch(e,function(){c.elementVoid("div","1",null,"id","iamme")}),expect(e.outerHTML).toBe('<div><div id="iamme"></div></div>'),e.children.item(0).setAttribute("data-added","item changed outside of renderer"),c.patch(e,function(){c.elementVoid("div","1",null,"id","iamstillme")}),expect(e.outerHTML).toBe('<div><div id="iamstillme" data-added="item changed outside of renderer"></div></div>')})}),describe("a render into text",function(){it("should not crash",function(){c.patch(null,function(){c.elementVoid("div","1",null,"id","iamme")})}),it("should return a div",function(){var e=c.patch(null,function(){c.elementVoid("div")});expect(e).toBe("<div></div>")}),it("should return a div with an id",function(){var e=c.patch(null,function(){c.elementVoid("div",null,["id","uno"])});expect(e).toBe('<div id="uno"></div>')}),it("should return a div with a component",function(){var e=c.patch(null,function(){c.elementVoid(l,null,null,"importance",7,"name","bond, jimmy-bob melon-field bond")}),t=document.createElement("div");c.patch(t,function(){c.elementVoid(l,null,null,"importance",7,"name","bond, jimmy-bob melon-field bond")});expect(e).toBe(t.innerHTML)})})},function(e,t){"use strict";function n(e,t){var n=e?e.__reactiv_view_node:null;return!n&&e&&(e.__reactiv_view_node=n={parent:null,tag:e.nodeName.toLowerCase(),node:e,key:null,attrs:{},kids:[]}),v=null,h=null,x=n,s=n,B=null,e?(c(e.nodeName,null,null),t(),void d()):(B="",t(),B)}function o(e,t,n,o,i,r,l,u,p){c.apply(null,arguments),d.apply(null,arguments)}function i(e,t){if(!s)return void(B+=e);var n=l("#text",null,null);if(n.text!==e){for(var o=n.text=e,i=1;i<arguments.length;i++){var c=arguments[i];c&&(o=c(o))}n.node.data=o}d()}function c(e,t,n,o,i,c,r,d,u){l.apply(null,arguments)}function r(e,t,n){if(null===n||void 0===n)return!1;var o=h.attrs[t];switch(t){case"style":if(!s){B+=' style="';var i=!0;for(var c in n)n.hasOwnProperty(c)&&(i||(B+=" "),i=!1,B+=c+": "+n[c]+";");B+='"';break}if(h.component)throw new Error("components don't have dom nodes, you cannot set styles directly on them");if("string"==typeof n){e.style.cssText=n;break}var r=e.style,l={};for(var d in n){var u=n[d];l[d]=!0,o&&o[d]===u||(r[d]=u,(h.attrs[t]=o=o||{})[d]=u)}for(var d in o)l[d]||(delete o[d],r[d]="");break;default:o!==n&&(h.attrs[t]=n),"className"===t&&(t="class"),-1!==["object","function"].indexOf(typeof n)?"on"===t.slice(0,2)&&"function"==typeof n&&function(e){var n=t.slice(2).toLowerCase();o!==e&&h.node.removeEventListener(n,o),h.node.addEventListener(n,e)}(n):h.component||(s?e.setAttribute(t,n):B+=" "+t+'="'+n+'"')}return!0}function l(e,t,n,o,i,c,l,d,u){m.apply(null,arguments);var p={},a=h.node;if(n)for(var f=0;f<n.length;f+=2)r(a,n[f],n[f+1])&&(p[n[f]]=!0);if(s||"string"==typeof e)for(var f=3;f<arguments.length;f+=2)r(a,arguments[f],arguments[f+1])&&(p[arguments[f]]=!0);s||"string"!=typeof e||(B+=">");for(var v in h.attrs)p[v]||("on"===v.slice(0,2)&&"function"==typeof h.attrs[v]?a.removeEventListener(v.slice(2).toLowerCase(),h.attrs[v]):h.component||s&&h.node.removeAttribute(v),delete h.attrs[v]);return h}function d(){if(!s)return void(V.length&&(B+=V.pop()));if(h){for(var e=h.kids;;){var t=e[e.length-1];if(!t||t===v)break;t.component&&t.component.componentWillUnmount&&t.component.componentWillUnmount(),h.node.removeChild(t.node),e.splice(e.indexOf(t),1)}for(var n=0,o=e.slice();n<o.length;n++){var t=o[n];t.parent!==h&&e.splice(e.indexOf(t),1)}}v=h,x=h&&h.parent?h.parent.kids[h.parent.kids.indexOf(h)+1]:void 0,h=h?h.parent:null}function u(e,t,n,o,i,c,r,l,d){h=x,x=h.kids[0];var u={};if(n)for(var p=0;p<n.length;p+=2){var a=n[p],m=n[p+1];null!==m&&void 0!==m&&(u[a]=m)}for(var p=3;p<arguments.length;p+=2){var f=arguments[p],m=arguments[p+1];null!==m&&void 0!==m&&(u[f]=m)}return u}function p(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return t&&e&&e.component&&e.component[t]?e.component[t].apply(h.component,n):void 0}function a(e,t){return e?void p(h,"render"):(h.component.props=h.component.props||{},p(h,"componentWillReceiveProps",t,h.component.state),h.component.props=t,p(h,"shouldComponentUpdate",t)===!1?(v=x,void(x=h.kids[h.kids.indexOf(v)+1])):(p(h,"componentWillUpdate",h.component.props,h.component.state),p(h,"render"),void p(h,"componentDidUpdate",h.component.props,h.component.state)))}function m(e,t,n,o,i,c,r,l,d){v=null;var m=x&&x.key===t;m&&(m="string"==typeof e?x.tag===e||x.tag===e.toLowerCase():x.component&&x.component.constructor.name===e.name);var y,b,M=h?h.kids:null;if(m){var g=u.apply(null,arguments);return void(h.component&&a(!m,g))}y=x,x=t&&h?M.filter(function(e){return e.key===t})[0]:null;var C=!1;if(!x)if("function"==typeof e)x={parent:h,node:null,tag:e.name,key:t,attrs:{},component:null,kids:[]},C=!0;else{s||(B+="<"+e,V.push("</"+e+">"));var L=h&&h.node?h.node.ownerDocument:document;x={parent:h,node:"#text"===e?L.createTextNode(""):L.createElement(e),tag:e.toLowerCase(),key:t,attrs:{},kids:[]}}h&&(M.splice(y?M.indexOf(y):M.length,0,x),b=h.node);var _=u.apply(null,arguments);if(C){var T=e.bind.apply(e,[null].concat([]));h.component=new T,h.component.props=_,h.component.state=h.component.state||p(h,"getState"),p(h,"componentWillMount")}h.component&&a(!m,_),m||f(b,t,M,y)}function f(e,t,n,o){if(s){if(h.component){if(!v)throw new Error("component didn't call any elements");h.node=v.node,h.node.__reactiv_view_node=h}e&&h.node&&(t&&n.filter(function(e){return e.key===t}).forEach(function(e){return e.node=h.node}),o&&o.node&&o.key?e.replaceChild(h.node,o.node):e.insertBefore(h.node,o?o.node:null))}h.component&&h.node&&p(h,"componentDidMount")}t.version=.1;var s,v,h,x,y=function(){function e(e){this.props=e}return e.prototype.componentWillMount=function(e,t){},e.prototype.componentDidMount=function(e,t){},e.prototype.componentWillUnmount=function(e,t){},e.prototype.shouldComponentUpdate=function(e,t){return!0},e.prototype.componentWillReceiveProps=function(e,t){},e.prototype.render=function(){},e.prototype.getState=function(){return this.state},e.prototype.setState=function(e){this.state=e},e}();t.Component=y;var B="";t.patch=n;var V=[];t.elementVoid=o,t.text=i,t.elementOpen=c,t.elementClose=d}]);